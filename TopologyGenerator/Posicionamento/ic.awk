#!/usr/bin/awk -f
{
  xvalues[x=$1] = $1;
  amostras[x=$1]++;
  for (j=1;j<=nrvar;j++) {
      n=j+1;
      v[$1,amostras[x=$1],j]=$n;
  }
}
END {
  if (ic==90) {
    t[30] = 1.699;  
    t[20] = 1.729;
    t[15] = 1.761;
    t[10] = 1.833;
    t[5] = 2.132;
    t[3] = 2.920;
  }
  if (ic==95) {
    t[2]=12.71;
    t[3]=4.303;
    t[4]=3.182;
    t[5]=2.776;
    t[6]=2.571;
    t[7]=2.447;
    t[8]=2.365;
    t[9]=2.306;
    t[10]=2.262;
    t[11]=2.228;
    t[12]=2.201;
    t[13]=2.179;
    t[14]=2.160;
    t[15]=2.145;
    t[16]=2.131;
    t[17]=2.120;
    t[18]=2.110;
    t[19]=2.101;
    t[20]=2.093;
    t[21]=2.086;
    t[22]=2.080;
    t[23]=2.074;
    t[24]=2.069;
    t[25]=2.064;
    t[26]=2.060;
    t[27]=2.056;
    t[28]=2.052;
    t[29]=2.048;
    t[30]=2.045;
    t[31]=2.042;
    t[32]=2.040;
    t[33]=2.037;
    t[34]=2.035;
    t[35]=2.032;
    t[36]=2.030;
    t[37]=2.028;
    t[38]=2.026;
    t[39]=2.024;
    t[40]=2.023;
    t[41]=2.021;
    t[42]=2.020;
    t[43]=2.018;
    t[44]=2.017;
    t[45]=2.015;
    t[46]=2.014;
    t[47]=2.013;
    t[48]=2.012;
    t[49]=2.011;
    t[50] = 2.010;
    t[100]= 1.984;
  }
  if (ic==99) {
    t[50] = 2.700
    t[30] = 2.756;
    t[20] = 2.861;
    t[15] = 2.977;
    t[10] = 3.25;
    t[5] = 4.604;
    t[3] = 9.925;
  }
  sort = "sort -n";
  for (x in xvalues) {
      for (j=1;j<=nrvar;j++) {
	  for (i=1;i<=amostras[x];i++) {
	      mv[x,j] = mv[x,j] + (v[x,i,j]/amostras[x]);
	  }
	  for(i=1;i<=amostras[x];i++){
	      var_v[x,j] = var_v[x,j] + ((v[x,i,j] - mv[x,j])^2)/(amostras[x]-1);
	  }
	  inter_v[x,j] = t[amostras[x]] * sqrt(var_v[x,j]/amostras[x]);
      }

      printf("%3.8f\t",x) | sort;

      for (j=1;j<=nrvar;j++) {
	  
	  printf("%2.8f\t%2.8f\t", mv[x,j], inter_v[x,j]) | sort;
      }
      printf("\n") | sort ;
  }
  close(sort);
}
